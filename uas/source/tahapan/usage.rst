*****
Usage
*****

Bagian ini akan dibagi menjadi bagian konversi dan konfigurasi (logstash & filebeat) serta bagian visualisasi kibana

Konversi dan Konfigurasi
########################

Tahapan selanjutnya adalah melakukan konversi sqlite ke json dan konfigurasi software yang dibutuhkan.

Konversi Sqlite ke Json
***********************

Mengunduh script pyhton untuk melakukan konversi

::

   $ wget https://raw.githubusercontent.com/eval2A/dionaeaToJSON/master/dionaeaSqliteToJson.py

Pindahkan script python tersebut ke folder opt

::

   $ mv dionaeaSqliteToJson.py /opt

Ubah default path pada script dionaeaSqliteToJson.py

::

   dionaeaSQLite = '/opt/dionaea/var/lib/dionaea/dionaea.sqlite'
   dionaeaBinariesPath = '/opt/dionaea/var/lib/dionaea/binaries'

Jika sudah jalankan script dionaeaSqliteToJson.py 

::
  
   $ python3 /opt/dionaeaSqliteToJson.py

Konfigurasi Logstash
********************

Buat file konfigurasi pada

::

   $ sudo vim /etc/logstash/conf.d/logstash-dionaea.conf

Ubah konfigurasi sebagai berikut:

::

   input {
          beats {
                 port => 5044
          }
   }
   filter {
           if [document_type] == "dionaea" {
                  json {
                        source => "message"
                  }
                  if [remote_host] {
                         mutate {
                                 copy => { "remote_host" => "remote_hostname" }
                         }
                         dns {
                                reverse => [ "remote_hostname" ]
                                nameserver => [ "8.8.8.8", "8.8.4.4" ]
                                action => "replace"
                                hit_cache_size => 4096
                                hit_cache_ttl => 900
                                failed_cache_size => 512
                                failed_cache_ttl => 900
                         }
                         geoip {
                                source => "remote_host"
                                target => "geoip"
                         }
                  }
                  mutate {
                          remove_tag => [ "beats_input_codec_plain_applied"]
                          remove_field => [ "source", "offset", "input_type"]
                  }
           }
   }
   output {
           if [document_type] == "dionaea" {
                  elasticsearch {
                         hosts => ["localhost:9200"]
                         index => "dionaea-%{+YYYY.MM.dd}"
                  }
           }
   }

Konfigurasi Filebeat
********************

Buatlah file konfigurasi filebeat

::

   $ cd /etc/filebeat
   $ mv filebeat.yml filebeat.yml.bak
   $ sudo vim filebeat.yml

Ubah konfigurasi sebagai berikut:

::

   filebeat.prospectors:
   - type: log
    paths:
     - /opt/dionaea/var/dionaea/json/dionaea.json*
    fields:
     document_type: dionaea
    fields_under_root: true
   output:
    logstash:
     hosts: ["localhost:5044"]
     bulk_max_size: 2048

Visualisas Kibana
#################

Berikut adalah tahapan visualisasi pada kibana

Membuat Index Pattern
*********************

Memastikan bahwa Elasticsearch dapat bekerja menerima index pattern dari logstash yang mendapatkan input Filebeat dari database Dionaea. Untuk membuktikan dapat dilakukan dengan 2 (dua) cara, yaitu :

1. Melalui web browser Kibana (Index pattern dapat digunakan jika nama Index yang dibituhkan telah tersedia)

+----------------------------------------------------------+
|Management > Kibana Index Pattern > Create Index Pattern  |
+----------------------------------------------------------+

2. Memeriksa transmisi data pada terminal output Logstash yang menunjukan file telah berhasil diterima dari Filebeat honeypot Dionaea.

Melakukan Visualisasi Data pada Browser
***************************************

.. image:: ../../images/visualisasitipe.jpg
    :width: 600px
    :align: center
    :height: 400px
    :alt: alternate text

Menentukan jenis visualisasi yang diinginkan, beberapa jenis visualisasi yang sering digunakan yakni sebagai berikut :

1. Line, area, and bar charts :Membandingkan perbedaan grafik melalui sumbu X dan Y
2. Pie chart : Menunjukan perbandingan data terhadap keseluruhan jumlah data
3. Data table : Menampikan data melalui format tabel
4. Matric: Menampilkan angka
5. Goal and gauge : Menampilkan angka dengan indikator progres
6. Tag cloud : Menunjukkan kumpulan kata pada cloud

Membuat Beberapa Jenis Visualisasi
**********************************

Buatlah beberapa jenis visualisasi untuk mempermudah pembacaan database malware

.. image:: ../../images/jenisvisualisasi.jpg
    :width: 400px
    :align: center
    :height: 200px
    :alt: alternate text

Beberapa jenis visualisasi dan kegunaannya:

+--------------------------------+--------------------------------------------------------+
| Visualisasi                    | Fungsi                                                 |
+================================+========================================================+
| Malware Attack                 | Menampilkan jenis serangan malware dalam format tabel  |
|                                |                                                        |
+--------------------------------+--------------------------------------------------------+
| Top 10 Username Password Login | Menunjukkan 10 username dan password yang              |
|                                | digunakan dalam percobaan login                        |
+--------------------------------+--------------------------------------------------------+
| Peta Serangan Malware          | Menunjukkan lokasi server IP yang digunakan            |
|                                | untuk melakukan penyerangan                            |
+--------------------------------+--------------------------------------------------------+
| Top 10 Negara                  | Menunjukkan 10 negara terbanyak yang melakukan         |
|                                | percobaan serangan                                     |
+--------------------------------+--------------------------------------------------------+
| Top 10 Port                    | Menunjukkan 10 port terbanyak yang digunakan           |
|                                | dalam percobaan serangan                               |
+--------------------------------+--------------------------------------------------------+

Tabel data ‘Malware Attack’ menggunakan field timestamp, geoip.country, connection_protocol, dan geoip.ip. Field tersebut memiliki fungsi masing-masing yang dijabarkan pada tabel berikut:

+--------------------------------+--------------------------------------------------------+
| Field                          | Fungsi                                                 |
+================================+========================================================+
| @timestamp                     | Menampilkan informasi waktu                            |
|                                |                                                        |
+--------------------------------+--------------------------------------------------------+
| geoip.country                  | Menampilkan informasi nama                             |
|                                | negara berdasarkan alamat IP                           |
+--------------------------------+--------------------------------------------------------+
| connection_protocol            | Menampilkan informasi protokol                         |
|                                | yang digunakan oleh penyerang                          |
+--------------------------------+--------------------------------------------------------+
| geoip.ip                       | Menampilkan infromasi alamat IP                        |
|                                | yang digunakan oleh penyerang                          |
+--------------------------------+--------------------------------------------------------+

.. image:: ../../images/regionmap.jpg
    :width: 600px
    :align: center
    :height: 300px
    :alt: alternate text

Region Map ‘Peta Serangan Malware’ menggunakan shape field berupa geoip.country_code3. Field tersebut memiliki fungsi untuk menampilkan peta negara asal penyerang dan jumlah serangan.

.. image:: ../../images/top10negara.jpg
    :width: 600px
    :align: center
    :height: 300px
    :alt: alternate text

Pie chart ‘Top 10 Negara’ menggunakan field geoip.country dan geoip.city yang keduanya digunakan untuk menunjukkan detail informasi letak IP yang digunakan oleh penyerang.

.. image:: ../../images/piecharttop10.jpg
    :width: 600px
    :align: center
    :height: 300px
    :alt: alternate text

Vertical Bar ‘Top 10 Port’ yang menunjukan informasi port yang diserang mengambil data dari field local_port.

.. image:: ../../images/verticaltop10.jpg
    :width: 600px
    :align: center
    :height: 300px
    :alt: alternate text

Table data ‘Top 10 Username Password Login’ menggunakan field login.username.keyword dan login.password.keyword untuk menampilkan username dan password login terbanyak dalam bentuk tabel.

.. image:: ../../images/tabeldata.jpg
    :width: 600px
    :align: center
    :height: 300px
    :alt: alternate text

Membuat Dashboard
*****************

Membuat dashboard dari kumpulan visualisasi yang telah dibuat

+-----------------------------------------------------------+
|Dashboard > Create new dashboard > Visit the Visualization |
+-----------------------------------------------------------+

.. image:: ../../images/dashboard1.jpg
    :width: 500px
    :align: center
    :height: 200px
    :alt: alternate text

Setelah visualisasi dipilih, akan muncul dashboard yang dibuat.

.. image:: ../../images/dashboard2.jpg
    :width: 500px
    :align: center
    :height: 200px
    :alt: alternate text

Dashboard yang telah dibuat dapat menunjukkan seluruh visualisasi yang telah diatur sebelumnya.

